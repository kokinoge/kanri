# 📊 データテーブル 一括編集・削除機能

## 概要

データテーブルページ（`/data-tables`）に一括選択・編集・削除機能を追加しました。これにより、複数のデータを効率的に管理できるようになります。

## 🎯 新機能

### 1. **一括操作モード**
- **選択モード切替**: ヘッダーの「一括操作」ボタンで選択モードを開始
- **チェックボックス表示**: 各テーブル行にチェックボックスが表示
- **視覚的フィードバック**: 選択されたアイテムは背景色が変更

### 2. **選択機能**
- **個別選択**: 各行のチェックボックスで個別アイテムを選択
- **全選択**: ヘッダーの「全選択」ボタンで現在表示中の全アイテムを選択
- **選択解除**: 「選択解除」ボタンで全選択を解除
- **選択カウント**: 選択数がボタンに表示

### 3. **一括編集機能**
- **フィールド別編集**: データタイプに応じた編集フォーム
- **リアルタイム更新**: 編集後に自動でデータ再取得
- **バリデーション**: 入力値の検証

### 4. **一括削除機能**
- **安全削除**: 確認ダイアログ付き
- **権限チェック**: 適切な権限レベルが必要
- **関連データ保護**: 関連データがある場合は削除制限

## 🚀 使用方法

### 一括操作の開始
1. データテーブルページ（`/data-tables`）にアクセス
2. ヘッダーの「一括操作」ボタンをクリック
3. 選択モードが開始され、チェックボックスが表示

### アイテムの選択
1. **個別選択**: 行のチェックボックスをクリック
2. **全選択**: 「全選択」ボタンをクリック
3. **選択解除**: 「選択解除」ボタンで全選択を解除

### 一括編集
1. 編集したいアイテムを選択
2. 「一括編集 (選択数)」ボタンをクリック
3. 編集ダイアログで値を入力
4. 「一括更新」ボタンで適用

### 一括削除
1. 削除したいアイテムを選択
2. 「一括削除 (選択数)」ボタンをクリック
3. 確認後に削除実行

## 📋 対応データタイプ

### 予算・実績データ
| 編集可能フィールド | 説明 | 例 |
|-------------------|------|-----|
| **支出額** | 実際の支出金額 | 500,000 |
| **実績** | 成果金額 | 750,000 |
| **プラットフォーム** | 媒体選択 | X, Instagram, TikTok, YouTube |

### クライアントデータ
| 編集可能フィールド | 説明 | 選択肢 |
|-------------------|------|--------|
| **優先度** | クライアント優先度 | 高, 中, 低 |
| **事業部** | 所属事業部 | SNSメディア事業部, インフルエンサー事業部, 広告事業部 |

### 案件データ
| 編集可能フィールド | 説明 | 例 |
|-------------------|------|-----|
| **目的** | 案件の目的 | ブランド認知, リード獲得 |

## 🔧 技術仕様

### UI/UXコンポーネント
- **選択モードボタン**: 切り替え可能なトグルボタン
- **チェックボックス**: ヘッダーと各行に配置
- **一括操作ボタン**: 選択数表示付き
- **背景色変更**: 選択アイテムの視覚的フィードバック

### バックエンド連携
- **一括編集API**: `PUT /api/{endpoint}/{id}` を並列実行
- **一括削除API**: `DELETE /api/{endpoint}/{id}` を並列実行
- **権限チェック**: 各操作で適切な権限レベルを確認

### エラーハンドリング
- **選択数チェック**: 未選択時のエラー表示
- **権限エラー**: 権限不足時の適切なメッセージ
- **ネットワークエラー**: 通信エラー時の再試行機能

## 💡 ベストプラクティス

### 効率的な選択
1. **フィルター活用**: 操作対象を事前にフィルタリング
2. **全選択活用**: 表示データ全体を対象にする場合
3. **段階的選択**: 大量データは分割して操作

### 安全な削除
1. **事前確認**: 削除前にデータを十分確認
2. **関連データチェック**: 関連する他のデータへの影響を確認
3. **バックアップ**: 重要データは事前にエクスポート

### 一括編集のコツ
1. **共通値のみ**: 選択したアイテム全てに適用される値を設定
2. **段階的更新**: 大量データは小分けにして更新
3. **検証**: 更新後にデータが正しく反映されているか確認

## 🔒 権限管理

### 一括編集権限
- **予算・実績**: メンバー以上
- **クライアント**: マネージャー以上
- **案件**: マネージャー以上

### 一括削除権限
- **予算・実績**: マネージャー以上
- **クライアント**: 管理者のみ（関連案件がない場合）
- **案件**: 管理者のみ

## 🐛 トラブルシューティング

### よくある問題

#### 1. 選択モードが開始できない
**原因**: JavaScript エラーまたは権限不足
**解決**: ページをリロードして再試行

#### 2. 一括編集が失敗する
**原因**: 権限不足または無効な値
**解決**: 
- 権限レベルを確認
- 入力値を検証
- 個別に編集を試す

#### 3. 一括削除が実行されない
**原因**: 関連データの存在または権限不足
**解決**:
- 関連データを先に削除
- 管理者権限で実行
- エラーメッセージを確認

#### 4. 選択が解除される
**原因**: ページリロードまたはフィルター変更
**解決**: 操作完了まで他の操作を控える

## 📈 パフォーマンス考慮事項

### 大量データ処理
- **選択制限**: 一度に500件まで推奨
- **分割処理**: APIリクエストの並列実行制御
- **タイムアウト**: 長時間処理のタイムアウト設定

### メモリ使用量
- **選択状態管理**: Set データ構造で効率的管理
- **DOM更新**: 仮想化テーブルで大量データ対応
- **メモリリーク**: 適切なクリーンアップ実装

## 🔄 操作フロー

### 典型的な一括編集フロー
```
1. データテーブルアクセス
2. フィルター設定（必要に応じて）
3. 「一括操作」ボタンクリック
4. 対象アイテムを選択
5. 「一括編集」ボタンクリック
6. 編集フォームで値を設定
7. 「一括更新」ボタンで実行
8. 完了確認とモード終了
```

### 一括削除フロー
```
1. データテーブルアクセス
2. 削除対象をフィルタリング
3. 「一括操作」ボタンクリック
4. 削除アイテムを選択
5. 「一括削除」ボタンクリック
6. 確認ダイアログで実行
7. 完了確認とモード終了
```

## 🎨 UI/UX 詳細

### 視覚的フィードバック
- **選択状態**: 青色背景（`bg-blue-50`）
- **ボタン状態**: 選択モード時は `default` variant
- **選択数表示**: ボタンテキストに選択数を表示
- **ローディング状態**: スピナーアイコンで進行状況表示

### アクセシビリティ
- **キーボード操作**: Tab キーでの操作対応
- **スクリーンリーダー**: aria-label 設定
- **色覚対応**: 色以外の視覚的手がかりも提供

---

**注意**: 一括操作機能は強力な機能です。特に削除操作は取り消せないため、十分な注意と確認を行ってから実行してください。重要なデータは事前にバックアップを取ることを強く推奨します。 