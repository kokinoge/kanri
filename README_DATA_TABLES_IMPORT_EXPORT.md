# 📊 データテーブル インポート・エクスポート機能

## 概要

データテーブルページ（`/data-tables`）にスプレッドシートのインポート・エクスポート機能を追加しました。この機能により、フィルタリングされたデータの管理とバックアップが簡単になります。

## 🎯 追加された機能

### 1. **データ管理ボタン**
- **場所**: データテーブルページのヘッダー部分
- **機能**: インポート・エクスポートダイアログを開く
- **操作**: 「データ管理」ボタンをクリック

### 2. **CSV出力機能（改良版）**
- **フォーマット改善**: データタイプに応じて最適化されたCSV出力
- **対応データ**: 
  - 予算・実績データ
  - クライアントデータ
  - 案件データ
- **日本語ヘッダー**: 理解しやすい列名

### 3. **Excel出力機能（新機能）**
- **フィルター適用**: 現在設定されているフィルター条件でデータを出力
- **高性能**: .xlsx形式での出力
- **ファイル名**: `filtered_data_YYYY-MM-DD.xlsx`

### 4. **フィルター連動エクスポート**
以下のフィルター条件が適用されます：
- 年フィルター
- 月フィルター  
- クライアントフィルター
- プラットフォームフィルター
- 運用タイプフィルター
- 事業部フィルター

## 🚀 使用方法

### インポート手順
1. データテーブルページ（`/data-tables`）にアクセス
2. 「データ管理」ボタンをクリック
3. 「インポート」タブを選択
4. .xlsxファイルを選択してアップロード
5. 自動的にページがリロードされ、新しいデータが反映

### エクスポート手順

#### CSV出力（表示データのみ）
1. 必要に応じてフィルターを設定
2. 見たいタブ（予算・実績、クライアント、案件）を選択
3. 「CSV出力」ボタンをクリック
4. ファイルがダウンロード

#### Excel出力（フィルター適用済み）
1. 必要なフィルター条件を設定
   - 年、月を指定
   - クライアントを絞り込み
   - プラットフォームを選択
   - 運用タイプを選択
   - 事業部を選択
2. 「Excel出力」ボタンをクリック
3. フィルター条件が適用された.xlsxファイルがダウンロード

## 📋 出力データ形式

### CSV出力（予算・実績）
| 列名 | 内容 |
|------|------|
| 年月 | YYYY年MM月 |
| クライアント名 | 会社名 |
| 案件名 | キャンペーン名 |
| プラットフォーム | 媒体名 |
| 運用タイプ | 運用方法 |
| 予算 | '-'（別テーブル） |
| 支出 | 実際の支出額 |
| 実績 | 成果金額 |
| ROAS | 広告費対効果 |
| 期間 | YYYY/MM |

### CSV出力（クライアント）
| 列名 | 内容 |
|------|------|
| クライアント名 | 会社名 |
| 担当者 | 担当者名 |
| 事業部 | 所属事業部 |
| 優先度 | 高/中/低 |
| 案件数 | 関連案件数 |
| 作成日 | 登録日 |

### CSV出力（案件）
| 列名 | 内容 |
|------|------|
| 案件名 | キャンペーン名 |
| クライアント名 | 会社名 |
| 目的 | 案件の目的 |
| 開始日 | 開始日 |
| 終了日 | 終了日 |
| 総予算 | 予算総額 |

## 🔧 技術仕様

### UI改善点
- **ヘッダーボタン配置**: データ管理、更新、CSV出力、Excel出力
- **フィルターヘルプテキスト**: 機能説明を追加
- **トースト通知**: 成功・エラーメッセージ表示

### API連携
- **インポート**: `POST /api/import-export`
- **エクスポート**: `GET /api/import-export?filters`
- **フィルターパラメータ**: year, month, clientId, platform, operationType, department

### エラーハンドリング
- データなしエラー
- インポートファイル形式エラー
- ネットワークエラー
- フィルター条件エラー

## 💡 ベストプラクティス

### データ分析ワークフロー
1. **フィルタリング**: 分析したい期間・条件を設定
2. **可視化**: データテーブルで確認
3. **エクスポート**: Excel出力で詳細分析
4. **レポート作成**: CSVデータで資料作成

### 定期運用
1. **月次エクスポート**: 毎月のデータをExcel形式で保存
2. **部門別分析**: 事業部フィルターで部門別データを出力
3. **クライアント別レポート**: クライアントフィルターで個別分析
4. **期間比較**: 異なる期間のデータを複数エクスポートして比較

## 🔄 データ更新フロー

### インポート後の確認手順
1. インポート完了後、自動的にページリロード
2. 統計情報（ヘッダー部分）の更新確認
3. 各タブでデータ件数の確認
4. フィルターをリセットして全データ確認

### バックアップ推奨
- **週次**: 全データのExcel出力
- **月次**: 部門別データの保存  
- **インポート前**: 現在データのバックアップ

## 🐛 トラブルシューティング

### よくある問題

#### 1. エクスポートファイルが空
**原因**: フィルター条件が厳しすぎる
**解決**: フィルターをリセットして再試行

#### 2. インポート後にデータが表示されない
**原因**: ブラウザキャッシュまたは非対応データ形式
**解決**: ページをハードリフレッシュ（Ctrl+F5）

#### 3. CSV出力が文字化け
**原因**: 文字エンコーディング問題
**解決**: UTF-8対応のアプリケーションで開く

## 📈 今後の拡張予定

- **自動スケジュールエクスポート**: 定期的な自動出力
- **カスタムフィルター保存**: よく使うフィルター条件の保存
- **テンプレートインポート**: 標準テンプレートの提供
- **リアルタイム同期**: クラウドストレージとの連携

---

**注意**: データテーブルページのインポート・エクスポート機能は、大量データの処理に対応していますが、ブラウザのメモリ制限に注意してください。非常に大きなファイル（10MB以上）の場合は、分割して処理することを推奨します。 