# 📊 スプレッドシートデータインポートガイド

## 概要

本システムではExcelスプレッドシート（.xlsx形式）からデータを直接インポートし、クライアント・案件・予算・実績データを自動的にデータベースに反映できます。

## 📋 対応データ形式

### 必須列（この順序で配置してください）

| 列番号 | 列名 | 説明 | 例 |
|--------|------|------|-----|
| 1 | 案件 | キャンペーン/案件名 | `Brighte ドライヤー` |
| 2 | 会社名 | クライアント会社名 | `Aiロボティクス株式会社` |
| 3 | 対象月 | 年月（YY/MM形式） | `24/12` |
| 4 | 部門 | 事業部門 | `SNSメディア部門` |
| 5 | 媒体 | 広告プラットフォーム | `X`, `Instagram`, `TikTok` |
| 6 | 運用タイプ | 運用方法 | `インハウス運用`, `インフルエンサー投稿` |
| 7 | 担当者 | 担当者名 | `佐藤葉月` |
| 8 | 金額 | 予算金額 | `¥500,000` |
| 9 | 実績 | 実績金額 | `¥500,000` |
| 10 | ジャンル | 予算タイプ | `投稿予算` |
| 11 | 営業先 | 営業部門 | `国内営業部` |
| 12 | 営業担当 | 営業担当者名 | `野下滉貴` |

### 重要な注意事項

#### 1. 事業部門のマッピング
スプレッドシートの「部門」列は以下のようにシステム内の事業部にマッピングされます：

| スプレッドシート表記 | システム内事業部 |
|---------------------|------------------|
| `SNSメディア部門` | `SNSメディア事業部` |
| `インフルエンサー部門` | `インフルエンサー事業部` |
| `広告部門` | `広告事業部` |

#### 2. 日付形式
- **正しい形式**: `24/12` (2024年12月)
- **間違った形式**: `2024/12`, `24-12`, `2024年12月`

#### 3. 金額形式
- **推奨形式**: `¥500,000`
- **対応形式**: `500000`, `500,000`
- システムが自動的に数値として解析します

## 🚀 インポート手順

### 1. データ準備
1. Excelファイル（.xlsx）でデータを準備
2. 上記の列順序と形式に従ってデータを入力
3. 1行目にはヘッダーを配置（システムが自動的にスキップ）

### 2. ウェブインターフェースからのインポート
1. システムにログイン
2. 任意のページで「データ管理」ボタンをクリック
3. 「インポート」タブを選択
4. Excelファイルを選択
5. 「インポート実行」をクリック

### 3. コマンドラインからのインポート
開発者向け：事前定義されたデータを使用する場合

```bash
# プロジェクトディレクトリで実行
npx tsx scripts/cleanAndImportData.ts
```

## 📈 インポート後の確認

### 1. データの確認先
- **クライアント分析ページ**: `/client-analysis`
- **データテーブル**: `/data-tables`
- **統合管理**: `/integrated-management`

### 2. 確認項目
- ✅ クライアント数が正しく表示されている
- ✅ 案件数が正しく表示されている
- ✅ 予算・実績金額が正確に反映されている
- ✅ プラットフォーム別分析が表示されている
- ✅ 月別トレンドが表示されている

## 🛠️ エラー対処法

### よくあるエラーと解決法

#### 1. 「無効な事業部をスキップします」
**原因**: 部門列の値が対応していない
**解決**: 以下の値のいずれかを使用
- `SNSメディア部門`
- `インフルエンサー部門`
- `広告部門`

#### 2. 「ファイルが見つかりません」
**原因**: ファイル選択が正しくされていない
**解決**: .xlsx形式のファイルを選択し直す

#### 3. 「データ処理エラー」
**原因**: 必須フィールド（案件、会社名、対象月）が空
**解決**: 必須フィールドを全て入力

## 📊 サンプルデータ

### スプレッドシートサンプル

| 案件 | 会社名 | 対象月 | 部門 | 媒体 | 運用タイプ | 担当者 | 金額 | 実績 | ジャンル | 営業先 | 営業担当 |
|------|--------|--------|------|------|-----------|--------|------|------|----------|--------|----------|
| Brighte ドライヤー | Aiロボティクス株式会社 | 24/12 | SNSメディア部門 | X | インハウス運用 | 佐藤葉月 | ¥500,000 | ¥500,000 | 投稿予算 | 国内営業部 | 野下滉貴 |
| GRL | 株式会社Gio | 24/12 | インフルエンサー部門 | Instagram | インフルエンサー投稿 | 小磯文弥 | ¥1,476,000 | ¥1,476,000 | 投稿予算 | 国内営業部 | 唐橋遼 |

## 🔧 開発者向け情報

### APIエンドポイント
- **インポート**: `POST /api/import-export`
- **エクスポート**: `GET /api/import-export?year=2024&month=12`

### データベース構造
インポートされたデータは以下のテーブルに格納されます：
- `Client`: クライアント情報
- `Campaign`: 案件情報
- `Budget`: 予算データ
- `Result`: 実績データ

### 自動化スクリプト
大量データの場合は、`scripts/cleanAndImportData.ts`を編集して自動化できます。

## 💡 ベストプラクティス

1. **定期的なバックアップ**: インポート前にデータベースをバックアップ
2. **段階的インポート**: 大量データは月単位で分割してインポート
3. **データ検証**: インポート後は必ず各ページでデータを確認
4. **エラーログ確認**: 問題が発生した場合はブラウザのコンソールを確認

## 🔄 データ更新

### 既存データの更新
- 同じ案件・クライアント・年月の組み合わせがある場合、既存データは更新されません
- 新しいデータを追加する場合は、異なる案件名または期間を使用してください

### データクリア
開発環境でデータを完全にリセットする場合：
```bash
npx tsx scripts/cleanAndImportData.ts
```

---

**注意**: 本機能は大量のデータを扱うため、インポート時間は案件数に比例します。500件程度のデータで約30秒程度かかります。 